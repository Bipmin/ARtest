<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web VR Test</title>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
    
    <script>
      AFRAME.registerComponent('collide', {
        init: function() {
        this.interactiveAnimations();
        this.el.addEventListener('click', this.onClick);
    },
    
    //クリックしたオブジェクトを回転させる
    interactiveAnimations: function() {
        this.el.setAttribute('animation__click', 'property:rotation; from:0 0 0; to: 0 360 0;  startEvents: click; dur:500');
    },
    
    //クリック位置の取得とパーティクルの設定
    onClick: function(e) {
        var createEffect = function(point, particleAge) {
        var pointStr = point.x + ' ' + point.y + ' ' + point.z;
        var effect = document.createElement('a-entity');
        effect.setAttribute('position', pointStr);
        effect.setAttribute('raycaster', 'enabled: false');
        effect.setAttribute('particle-system', 'preset: defolt; texture: ./images/redheart.png; maxParticleCount: 100;maxAge: ' + (particleAge / 1000) + ';velocityValue:0 -1 0; accelerationValue: 0 0.5 0; duration: 1;');
        return effect;
        };

        //パーティクルを表示させる
        var point = e.detail.intersection.point;
        var particleAge = 1500;
        var effect = createEffect(point, particleAge);
        var scene = document.querySelector('a-scene');
        scene.appendChild(effect);
        setTimeout(function() {
        scene.removeChild(effect);
        }, particleAge);
    }
}); 
    </script>
  </head>
  <body>
    <a-scene>
            <a-entity
            position="0 0 -7"
            particle-system="
                preset: star;
                texture: ./images/eff_shock1.png
                color: #ff0, #ff9 ;
                type: 1;
                accelerationValue: 0,0,0;
                accelerationSpread: 0 100 0;
                velocityValue: 0 10 0;
                particleCount: 10;
                maxAge: 0.1;
                size: 0.8;
                positionSpread: 2 0 2;
            ">
      <a-entity cursor="rayOrigin: mouse"></a-entity>
      <a-box position="0 0 -5" width="2" height="1" depth="1.5" color="#333" collide>
            
        </a-box>
    </a-scene>
  </body>
</html>