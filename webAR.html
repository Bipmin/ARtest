<!doctype HTML>
<html>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<title>webAR</title>
<link rel="stylesheet" href="./css/reset.css">
<link rel="stylesheet" href="./css/webAR.css">
<!-- A-Frame ライブラリの読み込み -->
<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
<!-- A-Frame のパーティクルシステム -->
<script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
<!-- AR.js ライブラリの読み込み -->
<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
<!-- HTML要素をA-Frame内に配置するスクリプト -->
<script src="./js/aframe-html-shader.min.js"></script>

<script>
        AFRAME.registerComponent('collide', {
          init: function() {
            this.interactiveAnimations();
            this.el.addEventListener('click', this.onClick);
          },
          interactiveAnimations: function() {
             this.el.setAttribute('animation__click', 'property: scale; to: 2 2 2; startEvents: click; dur:200');
          },
          onClick: function(e) {
            var createEffect = function(point, particleAge) {
              var pointStr = point.x + ' ' + point.y + ' ' + point.z;
              var effect = document.createElement('a-entity');
              effect.setAttribute('position', pointStr);
              effect.setAttribute('raycaster', 'enabled: false');
              effect.setAttribute('particle-system', 'color: #ff0, #ff9;maxParticleCount: 100;maxAge: ' + (particleAge / 1000) + ';velocityValue:0 -1 0; accelerationValue: 0 0.5 0; duration: 1;');
              return effect;
            };
            var point = e.detail.intersection.point;
            var particleAge = 1500;
            var effect = createEffect(point, particleAge);
            var scene = document.querySelector('a-scene');
            scene.appendChild(effect);
            setTimeout(function() {
              scene.removeChild(effect);
            }, particleAge);
          }
        });
</script>
<body>
    <!-- A-FrameStart -->
    <!-- <a-scene embedded arjs="debugUIEnabled:false;trackingMethod:best;patternRatio:0.90;" vr-mode-ui="enabled: false"></a-scene> -->
    <a-scene embedded arjs="debugUIEnabled:false;trackingMethod:best;" vr-mode-ui="enabled: false">
        <!-- オブジェクトファイルとマテリアルファイルを読み込む -->
        <a-assets>
        </a-assets>
    <!-- ARマーカー上になにを展開するかを書く -->
    <a-marker preset="hiro">
            <a-entity cursor="rayOrigin: mouse"></a-entity>
            <a-entity laser-controls="hand: right" raycaster="far: 50;"></a-entity>
            <a-entity position="0 2.25 -15" particle-system="preset: dust; texture: ./images/redheart.png"></a-entity>
            <!-- boxのテンプレート -->
            <a-box depth="1" height="1" width="1" position="0 0 0" src="./images/VRPA_1.jpg"  collide>
            <a-animation attribute="rotation" from="20 0 0" to="20 360 0" direction="alternate" dur="3000" repeat="indefinite" easing="ease">>
            </a-animation></a-box>
    </a-marker>
    <a-marker type="pattern" url="./marker/pattern-top.patt">
    <!-- boxのテンプレート -->
    <a-box depth="1" height="1" width="1" position="0 0 0">
    </a-marker>
            <!-- カメラ起動 -->
            <a-entity camera></a-entity>
    </a-scene>
    <!-- A-FrameEnd -->
</body>
</html>